<div class="p-6 bg-gray-50 min-h-screen">
  <div class="flex justify-between items-center mb-8">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">Tour Guides</h1>
      <p class="text-gray-500">Manage your guide inventory and assignments.</p>
    </div>
    <button (click)="openCreateModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition">
      + Add New Guide
    </button>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
      <p class="text-xs font-bold text-gray-400 uppercase">Total Guides</p>
      <h3 class="text-3xl font-bold text-gray-900">{{ guides().length }}</h3>
    </div>
    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
  <p class="text-xs font-bold text-green-500 uppercase">Active Guides</p>
  <h3 class="text-3xl font-bold text-gray-900">
    {{ activeGuidesCount() }}
  </h3>
</div>
  </div>

  <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
    <table class="w-full text-left">
      <thead class="bg-gray-50 border-b border-gray-200">
        <tr>
          <th class="px-6 py-4 text-xs font-semibold text-gray-500 uppercase">Guide</th>
          <th class="px-6 py-4 text-xs font-semibold text-gray-500 uppercase">Languages</th>
          <th class="px-6 py-4 text-xs font-semibold text-gray-500 uppercase">Rating</th>
          <th class="px-6 py-4 text-xs font-semibold text-gray-500 uppercase">Status</th>
          <th class="px-6 py-4 text-xs font-semibold text-gray-500 uppercase text-right">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        @for (guide of guides(); track guide.id) {
          <tr (click)="viewDetail(guide.id)" class="hover:bg-blue-50/30 cursor-pointer transition-colors">
            <td class="px-6 py-4">
              <div class="flex items-center gap-3">
                <img [src]="guide.photo_url || 'https://ui-avatars.com/api/?name='+guide.name" 
                     class="h-10 w-10 rounded-full object-cover">
                <div>
                  <div class="text-sm font-bold text-gray-900">{{ guide.name }}</div>
                  <div class="text-xs text-gray-500">{{ guide.email }}</div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4">
              <div class="flex flex-wrap gap-1">
                @for (lang of guide.languages; track lang) {
                  <span class="px-2 py-0.5 bg-gray-100 text-gray-600 rounded text-xs">{{ lang }}</span>
                }
              </div>
            </td>
            <td class="px-6 py-4">
              <div class="flex items-center text-yellow-500 font-bold">
                ‚≠ê {{ guide.rating }}
              </div>
            </td>
            <td class="px-6 py-4">
              <span class="px-2.5 py-0.5 rounded-full text-xs font-medium"
                [ngClass]="guide.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
                {{ guide.status }}
              </span>
            </td>
            <td class="px-6 py-4 text-right">
              <button (click)="toggleStatus(guide, $event)" 
                      class="text-sm font-semibold text-blue-600 hover:underline">
                {{ guide.status === 'active' ? 'Deactivate' : 'Activate' }}
              </button>
            </td>
          </tr>
        }
      </tbody>
    </table>
    
    @if (isLoading()) {
      <div class="p-10 text-center text-gray-400">Loading guides...</div>
    }
  </div>
</div>

@if (showModal() && selectedGuide(); as guide) {
  <div class="fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" (click)="closeModal()"></div>
    <div class="bg-white w-full max-w-lg rounded-2xl shadow-2xl relative z-10 overflow-hidden">
      <div class="h-32 bg-blue-600"></div>
      <div class="px-8 pb-8">
        <div class="relative flex justify-between items-end -mt-12 mb-6">
          <img [src]="guide.photo_url || 'https://ui-avatars.com/api/?name='+guide.name" 
               class="h-24 w-24 rounded-2xl border-4 border-white shadow-lg object-cover">
          <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-bold capitalize">
            {{ guide.status }}
          </span>
        </div>
        
        <h2 class="text-2xl font-bold text-gray-900">{{ guide.name }}</h2>
        <p class="text-gray-600 mt-2 text-sm leading-relaxed">{{ guide.bio || 'No bio available.' }}</p>

        <div class="mt-6 grid grid-cols-2 gap-4 border-t pt-6">
          <div>
            <label class="text-xs font-bold text-gray-400 uppercase">Email</label>
            <p class="text-sm text-gray-800">{{ guide.email }}</p>
          </div>
          <div>
            <label class="text-xs font-bold text-gray-400 uppercase">Phone</label>
            <p class="text-sm text-gray-800">{{ guide.phone }}</p>
          </div>
        </div>

        <button (click)="closeModal()" class="w-full mt-8 bg-gray-100 text-gray-600 py-2 rounded-xl font-bold hover:bg-gray-200 transition">
          Close Profile
        </button>
      </div>
    </div>
  </div>
}

@if (showCreateModal()) {
  <div class="fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" (click)="showCreateModal.set(false)"></div>
    
    <div class="bg-white w-full max-w-lg rounded-2xl shadow-2xl relative z-10 overflow-hidden animate-in fade-in zoom-in duration-200">
      <div class="p-6 border-b flex justify-between items-center bg-gray-50">
        <h2 class="text-xl font-bold text-gray-800">Create New Guide</h2>
        <button (click)="showCreateModal.set(false)" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
      </div>

      <form (submit)="submitGuide(); $event.preventDefault()" class="p-6 space-y-4">
        <div>
          <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Full Name</label>
          <input type="text" [(ngModel)]="newGuide().name" name="name" required
            class="w-full border rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Email</label>
            <input type="email" [(ngModel)]="newGuide().email" name="email" required
              class="w-full border rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div>
            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Phone</label>
            <input type="text" [(ngModel)]="newGuide().phone" name="phone"
              class="w-full border rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-blue-500">
          </div>
        </div>

        <div>
          <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Languages</label>
          <div class="flex flex-wrap gap-2 mt-1">
            @for (lang of ['English', 'Khmer', 'Chinese', 'French', 'Spanish']; track lang) {
              <button type="button" (click)="toggleLanguage(lang)"
                [class]="newGuide().languages.includes(lang) ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-600'"
                class="px-3 py-1 rounded-full text-xs font-medium transition-colors">
                {{ lang }}
              </button>
            }
          </div>
        </div>

        <div>
          <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Short Bio</label>
          <textarea [(ngModel)]="newGuide().bio" name="bio" rows="3"
            class="w-full border rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-blue-500"></textarea>
        </div>

        <div class="pt-4 flex gap-3">
          <button type="button" (click)="showCreateModal.set(false)" 
            class="flex-1 px-4 py-2 border rounded-lg font-bold text-gray-600 hover:bg-gray-50">
            Cancel
          </button>
          <button type="submit" [disabled]="isSubmitting()"
            class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 disabled:opacity-50">
            {{ isSubmitting() ? 'Creating...' : 'Create Guide' }}
          </button>
        </div>
      </form>
    </div>
  </div>
}